<!DOCTYPE html >
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
   <meta http-equiv="Content-Type" content="text/HTML; charset=UTF-8" />
	<link rel="shortcut icon" href="../commun/img/logomini.png" type="image/x-icon"/> 
	<title>Plantator v2</title>
	<meta name="description" content="Organisation potagère"/>
	<meta name="keywords" content="légume, permaculture, plante, jardin,potager,rotation,culture,semis,récolte" />
	<meta http-equiv="Refresh" content="0;url=http://metaphysik.fr/projet/plantator4.html"> 
	
	<link rel="stylesheet" title="style_commun" media="screen" type="text/css" href="plantator2.css"/>

	
	<link  href='http://fonts.googleapis.com/css?family=Raleway:400,300,500,600,700,800,900' rel='stylesheet' type='text/css'>
	<link href="../commun/font-awesome/css/font-awesome.min.css" rel="stylesheet">	

</head> 

<header></header>
<section id="comment"></section>
<section id="planches">
	<section id="titres"><span id="mois"><h5 class="hiver">J</h5><h5 class="hiver">F</h5><h5>M</h5><h5 class="ptps">A</h5><h5 class="ptps">M</h5><h5>J</h5><h5 class="ete">J</h5><h5 class="ete">A</h5><h5>S</h5><h5 class="automn">O</h5><h5 class="automn">N</h5><h5>D</h5></span><div class='titres'><h5 id="caract">Caractéristiques</h5><h5 id="semis">Semis</h5><h5 id="tmin">Tmin</h5><h5 id="emplacement">Emplacement</h5><h5 id="multi">Multiplication</h5><h5 id="racine">Racine</h5></div></section>
		<section id="catalogue">
		
		</section>
</section>
<footer>Mis en puissance par <a href="metaphysik.fr">Metaphysik</a> Tu veux <a href="https://docs.google.com/spreadsheets/d/16lEHNGDrBh-YhYjX1_25CwJuf_Qkn7bueKuizrN7Cag/edit#gid=1960947943">voir les données ou les compléter?</a>  </footer>
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script>

if (typeof Object.create != 'function') {
  // Production steps of ECMA-262, Edition 5, 15.2.3.5
  // Reference: http://es5.github.io/#x15.2.3.5
  Object.create = (function() {
    // To save on memory, use a shared constructor
    function Temp() {}

    // make a safe reference to Object.prototype.hasOwnProperty
    var hasOwn = Object.prototype.hasOwnProperty;

    return function (O) {
      // 1. If Type(O) is not Object or Null throw a TypeError exception.
      if (typeof O != 'object') {
        throw TypeError('Object prototype may only be an Object or null');
      }

      // 2. Let obj be the result of creating a new object as if by the
      //    expression new Object() where Object is the standard built-in
      //    constructor with that name
      // 3. Set the [[Prototype]] internal property of obj to O.
      Temp.prototype = O;
      var obj = new Temp();
      Temp.prototype = null; // Let's not keep a stray reference to O...

      // 4. If the argument Properties is present and not undefined, add
      //    own properties to obj as if by calling the standard built-in
      //    function Object.defineProperties with arguments obj and
      //    Properties.
      if (arguments.length > 1) {
        // Object.defineProperties does ToObject on its first argument.
        var Properties = Object(arguments[1]);
        for (var prop in Properties) {
          if (hasOwn.call(Properties, prop)) {
            obj[prop] = Properties[prop];
          }
        }
      }

      // 5. Return obj
      return obj;
    };
  })();
}
lg=40;//largeur d'un mois

pictos={
	eau:{
		img:'&#xf043;'
	},
	hauteur:{
		img:'&#xf07d;'
	},
	largeur:{
		img:'&#xf07e;'
	},
	pH:{
		couleur:["",'red','green','blue'],
		title:["",'pH acide','pH neutre','pH basique']
	},
	profondeur:{
		img:'&#xf175;'
	},
	racine:{
		nom:["",'pivotante','traçante','fasciculée']
	},
	sol:{
		img:'&#xf1b3;',
		couleur:["",'#FFE200','brown','#D00404'],
		title:["",'sableux/léger','équilibré','argileux/lourd']
	},
	soleil:{
		img:["",'&#xf185;','&#xf185;/&#xf0c2;','&#xf0c2;'],
		title:["",'ensoleillé','mi-ombre','ombre']
	},
	solriche:{
		title:["",'Besoins en nutriments faibles','Besoins en nutriments moyens','Besoins en nutriments élevés'],
		img:['','&#xf006;','&#xf123;','&#xf005;']
		
	},
	type:{
		feuille:'&#xf06c;',
		fruit:'&#xf094;',
		racine:'&radic;',
		fleur:'&#xf1e9;'
	},
	vivace:{
		img:'&#xf0e2;'		
	}
};
//froid<span class="awsm">&#xf069;</span>


var plante={};
$.ajax({
		url:"http://metaphysik.fr/projet/plantator.php",
		//data: cocode,
		dataType : 'html',
		type : 'GET', 
		error:function(jqHxr,statut,error){console.log('erreur:'+error)},	
		success:function(data){//console.log(data);
			plante=JSON.parse(data);//console.log(plante);
			i=-80;
			for(var j in plante){
				$('#catalogue').append(plantedsplanche(plante[j]));
			}
			
		}
	});				

$('body').on('click','h6', function(){
	affchbulle($(this).html(),$(this));
});

$('body').on('click','#catalogue article div,#catalogue article span', function(){
	infob=$(this).attr('title');//console.log(infob);
	if(infob!=undefined)affchbulle(infob,$(this));
});
$('#mois h5').on('click', function(){
	
	moischoisi=($('#mois h5').index($(this))+1);
	contenu='<span id="onlysemis">Semis</span><span id="onlyrecolte">Récolte</span>';
	affchbulle(contenu,$(this));
});

$('#comment').on('click','#onlysemis', function(){
$('#catalogue').empty();i=-80;

	for(var j in plante){
		semis=parseInt( (plante[j].semisext!=0)?plante[j].semisext:plante[j].semisabri );
		//console.log(semis);
		semis=parseInt((semis==0)?plante[j].semisint:semis );
		
		//console.log(moischoisi+1);
			if((semis<(moischoisi+1))&&(semis>(moischoisi-2))){//console.log(semis);
				$('#catalogue').append(plantedsplanche(plante[j]));
			}
	}
$('#comment').empty();	
});

$('#comment').on('click','#onlyrecolte', function(){
	$('#catalogue').empty();i=-80;
	for(var j in plante){
			if(((plante[j].recolteDeb<moischoisi)&&(plante[j].recolteFin>moischoisi))||(((plante[j].recolteFin-plante[j].recolteDeb)<0)&&(plante[j].recolteFin>moischoisi))){
				$('#catalogue').append(plantedsplanche(plante[j]));
			}
	}
$('#comment').empty();	
});


function affchbulle(contenu,obj){
	$('.actif').removeClass('actif');
	obj.addClass('actif');
	x=obj.offset().left;
	y=obj.offset().top;//console.log(x+','+y);
	content='<div style="left:'+x+'px;top:'+(y+40)+'px">'+contenu
	+'</div>';
	$('#comment').html(content);
}
	
/*var Solanaceae = Object.create(plante);
Solanaceae.semisint=2;
Solanaceae.semisabri=3;
Solanaceae.semisext=4;
Solanaceae.type='fruit';
Solanaceae.soleil=1;
Solanaceae.hauteur=30;
Solanaceae.racine=2;
Solanaceae.sol='riche';
Solanaceae.vie=1;
Solanaceae.profondeur=1;
Solanaceae.ecartement=50;


var aubergine=Object.create(Solanaceae);
aubergine.semisext=4;
aubergine.nom='aubergine';
aubergine.recolteDbt=7;
aubergine.recolteFin=10; */





h=80;decalage=80;
function plantedsplanche(p){
i=h+i;
	
	
	html='<article style="top:'+i+'px"><h6><span>'+ud(p.nom)+'</span><span class="famille">'+ud(p.famille)+'</span></h6>';
	//croissance
	semis=(p.semisext!=0)?p.semisext:p.semisabri;
	semis=(semis==0)?p.semisint:semis;
	croissance=	p.recolteDeb - semis;//console.log(p.nom+' '+croissance);
	if(croissance>0){
		html+='<div class="veg" style="width:'+croissance*lg+'px;left:'+((semis-1)*lg+decalage)+'px;" title="période végétative/croissance"></div>';}
	else{
		html+='<div class="veg" style="width:'+(12-semis)*lg+'px;left:'+((semis)*lg+decalage)+'px;" title="période végétative/croissance"></div>';
		html+='<div class="veg" style="width:'+(p.recolteDeb-1)*lg+'px;left:'+decalage+'px;" title="période végétative/croissance"></div>';
		}	
	//récolte
	recolteDuree=p.recolteFin-p.recolteDeb;	
	if(recolteDuree>0){
		html+='<div class="recolte" style="width:'+recolteDuree*lg+'px;left:'+((p.recolteDeb-1)*lg+decalage)+'px;" title="période de récolte"></div>';
	}
	else{
		html+='<div class="recolte" style="width:'+(12-p.recolteDeb)*lg+'px;left:'+(p.recolteDeb*lg+decalage)+'px;" title="période de récolte"></div>';
		html+='<div class="recolte" style="width:'+(p.recolteFin-1)*lg+'px;left:'+decalage+'px;" title="période de récolte"></div>';
	}
	html+='<div class="caract">';
	if(p.vie>0)html+='Vit '+p.vie+' an(s) </span>';
		if(p.vivace==1)html+='<span style="color:orange" class="awsm" title="se comporte comme une vivace">'+pictos.vivace.img+'</span>';
	if(p.hauteur>0)html+='<br/><span class="awsm" title="hauteur de la plante">'+pictos.hauteur.img+p.hauteur+'cm</span>';
	html+='</div>';
	html+='<div class="tmin" title="Température minimum supportée par la plante">'+ud(p.Tmin)+'°C</div>';
	
	html+='<div class="emplacement">';
		html+='<span class="awsm" title="emplacement '+pictos.soleil.title[p.soleil]+' ">'+pictos.soleil.img[p.soleil]+'</span>';
		if((p.sol>0)&&(p.sol<4)){html+='<span class="awsm" title="substrat '+pictos.sol.title[p.eau]+p.sol+'" style="color:'+pictos.sol.couleur[p.eau]+'">'+pictos.sol.img+'</span>';}
		if((p.pH>0)&&(p.pH<4))html+='<span title="'+pictos.pH.title[p.pH]+'" style="color:'+pictos.pH.couleur[p.pH]+'">pH</span>';
		html+='<span class="awsm" style="color:#00CC00" title="'+pictos.solriche.title[p.solriche]+'">'+pictos.solriche.img[p.solriche]+'</span>';
		
	html+='</div><div class="semis">';
		if(p.prof>0)html+='<span class="awsm" title="profondeur de semis">'+pictos.profondeur.img+p.prof+'cm</span><br/>';
		if(p.drang>0)html+='<span class="awsm" title="espacement dans le rang">'+pictos.largeur.img+p.drang+'cm</span>';
		
	html+='</div><div class="multi" title="méthode de multiplication">'+ud(p.multi);
	html+='</div>';	
	
	if(p.type!=''){
		html+='<div class="awsm type" title="partie comestible de la plante:';
		html2="";
		types=p.type.split("_");
		for(var k in types){
			html2+=pictos.type[types[k]];
			html+=types[k]+'';
		}
		html+='">'+html2+'</div>';
	}
	
	
	html+='<div class="racine" title="La racine est '+pictos.racine.nom[p.racine]+'">'+pictos.racine.nom[p.racine]+'</div>';
	html+='<div class="autre">'+ud(p.commentaire)+'</div></article>';
	$("html").animate({ scrollTop: 0 }, "slow");
return html;
}

function ud(s){
	s=(s=='undefined')?'':s;
	return s;
}

<!-- Google analytics -->

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-31682286-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script> 
